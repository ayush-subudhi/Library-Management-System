{% extends "base.html" %}
{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Admin Dashboard</h3>
    <div>
      <a class="btn btn-sm btn-success" href="{{ url_for('add_book') }}">Add Book</a>
      <a class="btn btn-sm btn-primary" href="{{ url_for('issue') }}">Issue Book</a>
    </div>
  </div>

  <h5>Recent Transactions</h5>
  <table class="table table-sm">
    <thead><tr><th>Book</th><th>Student</th><th>Issued</th><th>Due</th><th>Returned</th><th>Fine</th><th>Action</th></tr></thead>
    <tbody>
      {% for t in transactions %}
        <tr>
          <td>{{ t['title'] or 'â€”' }}</td>
          <td>{{ t['student_id'] }}</td>
          <td>{{ t['issued_at'][:10] if t['issued_at'] else '' }}</td>
          <td>{{ t['due_date'] }}</td>
          <td>{{ t['returned_at'][:10] if t['returned_at'] else '' }}</td>
          <td>{{ t['fine'] }}</td>
          <td>
            {% if not t['returned_at'] %}
            <form method="post" action="{{ url_for('return_book', tx_id=t['id']) }}" style="display:inline">
              <button class="btn btn-sm btn-warning">Return</button>
            </form>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <h5 class="mt-4">Books</h5>
  <table class="table table-striped">
    <thead><tr><th>ID</th><th>Title</th><th>Author</th><th>Qty</th><th>Actions</th></tr></thead>
    <tbody>
      {% for b in books %}
      <tr>
        <td>{{ b['id'] }}</td>
        <td>{{ b['title'] }}</td>
        <td>{{ b['author'] }}</td>
        <td>{{ b['quantity'] }}</td>
        <td>
          <a class="btn btn-sm btn-outline-primary" href="{{ url_for('edit_book', book_id=b['id']) }}">Edit</a>
          <form method="post" action="{{ url_for('delete_book', book_id=b['id']) }}" style="display:inline">
            <button class="btn btn-sm btn-outline-danger">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}
